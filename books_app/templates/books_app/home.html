{% extends "books_app/base.html" %}

{% load static %}

{% block body_class %}home-page{% endblock %}
{# By adding a class to the body, we can apply page-specific styles from base.html #}
 
{% block title %}Home - eBooks{% endblock %}

{% block content %}
  <div class="page-header">
    <h1>Available Books</h1>
    <p>Browse the collection or search for a specific title or author.</p>
  </div>

  <!-- Search Form -->
  <form method="get" action="{% url 'books_app:home' %}" class="search-form">
    <input type="text" name="q" placeholder="Search by title or author..." value="{{ query|default:'' }}">
    <button type="submit" title="Search">üîç</button>
  </form>

  <!-- This is the grid container -->
  <div class="book-grid">
    {% for book in books %}
        <!-- This is the new book item card -->
        <div class="book-item">
            <a href="{% url 'books_app:book_detail' pk=book.pk %}" class="book-cover-link">
                {% if book.cover_image %}
                    <img src="{{ book.cover_image.url }}" alt="Cover for {{ book.title }}" class="book-cover">
                {% else %}
                    <!-- Placeholder for books without an image -->
                    <div class="book-cover placeholder">
                        <span>No Image</span>
                    </div>
                {% endif %}
            </a>
            <div class="book-details">
                <h2>{{ book.title }}</h2>
                <p>by {{ book.author }}</p>
                {% if book.get_file_size %}
                    <p class="book-meta">Size: {{ book.get_file_size }}</p>
                {% endif %}
            </div>
            <!-- Action buttons -->
            <div class="book-actions">
                <div class="action-item">
                    <a href="{{ book.book_file.url }}" class="button-link preview" title="Preview in new tab" target="_blank">
                        <lord-icon src="https://cdn.lordicon.com/tyounuzx.json" trigger="hover" colors="primary:var(--primary-color),secondary:var(--accent-color)" style="width:40px;height:40px"></lord-icon>
                    </a>
                    <span class="action-count">{{ book.view_count }} views</span>
                </div>
                <div class="action-item">
                    {% if book.book_file %}
                        <a href="{% url 'books_app:download_book' pk=book.pk %}" class="button-link download-button" title="Download">
                            <svg class="icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                        </a>
                        <span class="action-count">{{ book.download_count }} downloads</span>
                    {% endif %}
                </div>
            </div>            
        </div>
    {% empty %}
        <div class="no-results">
            <h3>No Books Found</h3>
            <p>There are no books matching your search for "<strong>{{ query }}</strong>". Try a different search or <a href="{% url 'books_app:request_book' %}">request a new book</a>.</p>
        </div>
    {% endfor %}
  </div>
{% endblock %}